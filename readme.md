# üßπ clean_doc.py ‚Äî –û—á–∏—Å—Ç–∫–∞ DOCX –æ—Ç UTF-8

> **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ mojibake –∏ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ Microsoft Word**

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

üîß **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
- –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç **mojibake** (–æ—à–∏–±–æ—á–Ω–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ UTF-8 ‚áÜ CP1251) —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `ftfy`
- –£–¥–∞–ª—è–µ—Ç –Ω–µ–≤–∏–¥–∏–º—ã–µ —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã (`Cf`, `Cc`)
- –°–æ–∑–¥–∞—ë—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö

üìä **–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ mojibake
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º

üíæ **–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Å—É—Ñ—Ñ–∏–∫—Å –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –û–ø—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- –¢–∏—Ö–∏–π —Ä–µ–∂–∏–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
source venv/bin/activate        # Linux/macOS
# –∏–ª–∏
venv\Scripts\activate          # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ó–∞–¥–∞—á–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|--------|---------|
| **–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ DOCX –≤ –ø–∞–ø–∫–µ —Å–∫—Ä–∏–ø—Ç–∞** | `python clean_doc.py` |
| **–û—á–∏—Å—Ç–∏—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** | `python clean_doc.py –î–æ–≥–æ–≤–æ—Ä.docx –°–º–µ—Ç–∞.docx` |
| **–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** | `python clean_doc.py -b` |
| **–ò–∑–º–µ–Ω–∏—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å** | `python clean_doc.py --suffix _fixed` |
| **–¢–∏—Ö–∏–π —Ä–µ–∂–∏–º** | `python clean_doc.py -q` |

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `-b, --backup` | –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.bak` |
| `--suffix SUFFIX` | –ó–∞–¥–∞—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `_clean`) |
| `-q, --quiet` | –¢–∏—Ö–∏–π —Ä–µ–∂–∏–º –±–µ–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –∏ –æ—Ç—á—ë—Ç–æ–≤ |

> üí° **–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã, —Å–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ `.docx` —Ñ–∞–π–ª—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ —Å–∫—Ä–∏–ø—Ç–∞.

## üìã –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

```bash
$ python clean_doc.py -b
Cleaning DOCX: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:00<00:00,  3.01—Ñ–∞–π–ª/—Å]

üìÑ –î–æ–≥–æ–≤–æ—Ä.docx:    –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ mojibake = 37, —É–¥–∞–ª–µ–Ω–æ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö = 12
üìÑ –°–º–µ—Ç–∞.docx:      –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ mojibake = 15, —É–¥–∞–ª–µ–Ω–æ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö = 0

‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: 2 | –≤—Å–µ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ mojibake: 52 | –≤—Å–µ–≥–æ —É–¥–∞–ª–µ–Ω–æ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö: 12
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 1. –û—Ç—á—ë—Ç —Å–∫—Ä–∏–ø—Ç–∞
–ü–µ—Ä–≤–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

### 2. –í–∏–∑—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–û—Ç–∫—Ä–æ–π—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π –∏ –æ—á–∏—â–µ–Ω–Ω—ã–π —Ñ–∞–π–ª—ã –≤ Microsoft Word –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

### 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
```bash
pip install docx2txt
docx2txt –î–æ–≥–æ–≤–æ—Ä.docx orig.txt
docx2txt –î–æ–≥–æ–≤–æ—Ä_clean.docx clean.txt
diff -u orig.txt clean.txt | less
```

### 4. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã
```bash
sha256sum –î–æ–≥–æ–≤–æ—Ä.docx –î–æ–≥–æ–≤–æ—Ä_clean.docx
```

## üéØ –ö–æ–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞

| –ö–æ–¥ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----|----------|
| `0` | ‚úÖ –û—á–∏—Å—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ |
| `2` | ‚ùå –í –∫–∞—Ç–∞–ª–æ–≥–µ –Ω–µ—Ç DOCX-—Ñ–∞–π–ª–æ–≤ |

## üåê –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- **–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã**: Windows, macOS, Linux
- **Python**: 3.6+
- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∞–≤
- **–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤**: Microsoft Word (.docx)

## üìö –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```txt
python-docx>=0.8.11
ftfy>=6.1.0
tqdm>=4.64.0
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –¢–∏–ø—ã –∏—Å–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –ø—Ä–æ–±–ª–µ–º

**Mojibake (–∫—Ä–∞–∫–æ–∑—è–±—Ä—ã)**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ UTF-8 ‚áÜ CP1251
- –ò—Å–∫–∞–∂—ë–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
- –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∏–∞–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –∑–Ω–∞–∫–∞–º–∏

**–£–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã**
- Unicode –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ `Cf` (Format, other)
- Unicode –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ `Cc` (Control)
- –ù–µ–≤–∏–¥–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ –∏ runs –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
2. **–ê–Ω–∞–ª–∏–∑**: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ mojibake –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ ftfy –¥–ª—è mojibake, —É–¥–∞–ª–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ –æ—á–∏—â–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏ —Å –∑–∞–¥–∞–Ω–Ω—ã–º —Å—É—Ñ—Ñ–∏–∫—Å–æ–º
5. **–û—Ç—á—ë—Ç**: –í—ã–≤–æ–¥ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

*–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤.*
